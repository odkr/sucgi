==============
Building suCGI
==============

Configuration
=============

Use *configure* to Generate *makefile* and *config.h*.

If you want to adapt suCGI's build settings, edit *configure.env* and create
a (new) makefile by calling ``configure``; supply ``-f`` to overwrite existing
files (e.g., ``CC=/opt/obscure/bin/occ ./configure -f``).

*configure* also respects the following environment variables:

CC
    The C compiler.

CFLAGS
    Flags to give to the compiler.


Compilation
===========

Compile suCGI by calling ``make``.

Makefile variables
------------------

You can pass the following variables to ``make`` to configure compilation:

CC
    The C compiler
    (default is generated by ``configure``).

CFLAGS
    Flags to give to the C compiler
    (default is generated by ``configure``).

ARFLAGS
    Flags to give to the archiver
    (default depends on *make*).

LDFLAGS
    Flags to give to the compiler when it invokes the linker
    (default depends on *make*).

LDLIBS
    Flags or names to give to the compiler when it invokes the linker
    (default depends on *make*).


Macros
------

The following macros govern compilation:

TESTING
    Whether to build for testing. Boolean value.
    Test builds are insecure!


Installation
============

Install suCGI by ``make install``.

You can pass the following variables to ``make`` to adapt the installation:

DESTDIR
    Prefix for staged installations
    (default depends on *make*).

PREFIX
    Prefix for installation targets
    (defaults to */usr/local*).

CGIBIN
    Path to your webserver's */cgi-bin* directory
    (defaults to */usr/lib/cgi-bin*).

WWWGRP
    Group the webserver runs as
    (defaults to "www-data").


Other targets
=============

The *makefile* supports the following 'phony' targets:

all
    Alias for "sucgi" and the default target.

analysis
    Analyse the code with Cppcheck_, Flawfinder_, RATS_, and
    ShellCheck_, if they are installed.

check
    Perform tests. Must be run as the superuser to perform all tests.

cov
    Generate coverage data.
    Must be run *twice* as superuser in order to be accurate.
    Requires and only works with Clang_.
    Currently somewhat defunct.

covhtml
    Alias for "cov/index.html". Requires LCOV_.

clean
    Delete binaries, coverage data, temporary files, and distribution files.

dist
    Make a distribution package. Requires *tar* and GnuPG_.

distcheck
    Check if the distribution compiles,
    passes the test suite, and is self-contained.

distclean
    Delete *config.h*, *makefile* and everything ``make clean`` deletes.

install
    Install suCGI.

uninstall
    Uninstall suCGI.


.. _Clang: https://clang.llvm.org/

.. _Cppcheck: https://cppcheck.sourceforge.io/

.. _Flawfinder: https://dwheeler.com/flawfinder/

.. _RATS: https://github.com/andrew-d/rough-auditing-tool-for-security

.. _ShellCheck: https://www.shellcheck.net/

.. _LCOV: https://github.com/linux-test-project/lcov

.. _GnuPG: https://www.gnupg.org/
